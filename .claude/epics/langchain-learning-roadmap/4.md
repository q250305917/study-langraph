---
name: 示例模板系统：创建参数化的示例代码模板
status: open
created: 2025-09-21T02:48:13Z
updated: 2025-09-21T12:53:06Z
github: https://github.com/q250305917/study-langraph/issues/4
depends_on: [002]
parallel: true
conflicts_with: []
---

## 描述

创建一套完整的参数化示例代码模板系统，覆盖 LangChain 的所有核心应用场景。这些模板将帮助学习者快速理解和应用不同的 LangChain 功能，同时提供可复用的代码结构。

## 验收标准

- [ ] 创建模板基础框架系统
- [ ] 实现 LLM 操作模板（多种模型接入）
- [ ] 实现 Prompt 模板（各种场景）
- [ ] 实现 Chain 组合模板（顺序、并行、条件）
- [ ] 实现 Agent 模板（工具调用、决策）
- [ ] 实现数据处理模板（文档分割、向量化）
- [ ] 实现记忆系统模板（对话历史、知识库）
- [ ] 实现评估模板（效果评估、A/B测试）
- [ ] 提供配置文件系统（支持环境变量）
- [ ] 创建模板使用文档和示例

## 技术细节

### 模板系统结构
```
templates/
├── base/
│   ├── template_base.py          # 模板基类
│   ├── config_loader.py          # 配置加载器
│   └── parameter_validator.py    # 参数验证器
├── llm/
│   ├── openai_template.py        # OpenAI模板
│   ├── anthropic_template.py     # Anthropic模板
│   ├── local_llm_template.py     # 本地模型模板
│   └── multi_model_template.py   # 多模型对比模板
├── prompts/
│   ├── chat_template.py          # 对话模板
│   ├── completion_template.py    # 补全模板
│   ├── few_shot_template.py      # 少样本学习模板
│   └── role_playing_template.py  # 角色扮演模板
├── chains/
│   ├── sequential_chain.py       # 顺序链模板
│   ├── parallel_chain.py         # 并行链模板
│   ├── conditional_chain.py      # 条件链模板
│   └── pipeline_chain.py         # 管道链模板
├── agents/
│   ├── react_agent.py           # ReAct代理模板
│   ├── tool_calling_agent.py    # 工具调用代理模板
│   ├── planning_agent.py        # 规划代理模板
│   └── multi_agent_template.py  # 多代理协作模板
├── data/
│   ├── document_loader.py        # 文档加载模板
│   ├── text_splitter.py         # 文本分割模板
│   ├── vectorstore_template.py  # 向量存储模板
│   └── retrieval_template.py    # 检索模板
├── memory/
│   ├── conversation_memory.py    # 对话记忆模板
│   ├── summary_memory.py        # 摘要记忆模板
│   ├── vector_memory.py         # 向量记忆模板
│   └── knowledge_base.py        # 知识库模板
├── evaluation/
│   ├── accuracy_eval.py         # 准确性评估模板
│   ├── performance_eval.py      # 性能评估模板
│   ├── cost_analysis.py         # 成本分析模板
│   └── ab_testing.py           # A/B测试模板
└── configs/
    ├── development.yaml         # 开发环境配置
    ├── production.yaml          # 生产环境配置
    └── template_configs/        # 各模板专用配置
```

### 核心实现代码

#### 模板基类示例
```python
# templates/base/template_base.py
from abc import ABC, abstractmethod
from typing import Dict, Any, Optional
import yaml
import os
from dataclasses import dataclass
from .config_loader import ConfigLoader
from .parameter_validator import ParameterValidator

@dataclass
class TemplateConfig:
    """模板配置数据类"""
    name: str
    description: str
    parameters: Dict[str, Any]
    dependencies: list
    examples: list

class TemplateBase(ABC):
    """模板基类，所有模板都需要继承此类"""
    
    def __init__(self, config_path: Optional[str] = None):
        self.config_loader = ConfigLoader()
        self.validator = ParameterValidator()
        self.config = self._load_config(config_path)
        
    def _load_config(self, config_path: Optional[str]) -> TemplateConfig:
        """加载模板配置"""
        if config_path:
            return self.config_loader.load_from_file(config_path)
        return self.config_loader.load_default(self.__class__.__name__)
    
    @abstractmethod
    def setup(self, **parameters) -> None:
        """设置模板参数"""
        pass
    
    @abstractmethod
    def execute(self, **kwargs) -> Any:
        """执行模板逻辑"""
        pass
    
    @abstractmethod
    def get_example(self) -> Dict[str, Any]:
        """获取使用示例"""
        pass
    
    def validate_parameters(self, parameters: Dict[str, Any]) -> bool:
        """验证参数有效性"""
        return self.validator.validate(self.config.parameters, parameters)
```

#### LLM模板示例
```python
# templates/llm/openai_template.py
from ..base.template_base import TemplateBase
from langchain_openai import ChatOpenAI
from langchain_core.messages import HumanMessage, SystemMessage
from typing import Dict, Any, List

class OpenAITemplate(TemplateBase):
    """OpenAI模型使用模板"""
    
    def __init__(self, config_path: Optional[str] = None):
        super().__init__(config_path)
        self.llm = None
        
    def setup(self, **parameters) -> None:
        """设置OpenAI模型参数"""
        # 验证参数
        if not self.validate_parameters(parameters):
            raise ValueError("参数验证失败")
        
        # 设置模型参数
        model_name = parameters.get('model_name', 'gpt-3.5-turbo')
        temperature = parameters.get('temperature', 0.7)
        max_tokens = parameters.get('max_tokens', 1000)
        api_key = parameters.get('api_key', os.getenv('OPENAI_API_KEY'))
        
        # 初始化模型
        self.llm = ChatOpenAI(
            model=model_name,
            temperature=temperature,
            max_tokens=max_tokens,
            api_key=api_key
        )
    
    def execute(self, **kwargs) -> Any:
        """执行LLM调用"""
        if not self.llm:
            raise RuntimeError("请先调用setup()方法初始化模型")
        
        messages = kwargs.get('messages', [])
        system_prompt = kwargs.get('system_prompt')
        user_input = kwargs.get('user_input')
        
        # 构建消息列表
        formatted_messages = []
        if system_prompt:
            formatted_messages.append(SystemMessage(content=system_prompt))
        
        if user_input:
            formatted_messages.append(HumanMessage(content=user_input))
        
        formatted_messages.extend(messages)
        
        # 执行调用
        response = self.llm.invoke(formatted_messages)
        return response
    
    def get_example(self) -> Dict[str, Any]:
        """获取使用示例"""
        return {
            "setup_parameters": {
                "model_name": "gpt-3.5-turbo",
                "temperature": 0.7,
                "max_tokens": 1000
            },
            "execute_parameters": {
                "system_prompt": "你是一个有用的AI助手",
                "user_input": "介绍一下LangChain的主要功能"
            },
            "usage_code": """
# 使用示例
from templates.llm.openai_template import OpenAITemplate

# 初始化模板
template = OpenAITemplate()

# 设置参数
template.setup(
    model_name="gpt-3.5-turbo",
    temperature=0.7,
    max_tokens=1000
)

# 执行调用
response = template.execute(
    system_prompt="你是一个有用的AI助手",
    user_input="介绍一下LangChain的主要功能"
)

print(response.content)
"""
        }
```

#### Chain模板示例
```python
# templates/chains/sequential_chain.py
from ..base.template_base import TemplateBase
from langchain.chains import SequentialChain, LLMChain
from langchain_core.prompts import PromptTemplate
from typing import Dict, Any, List

class SequentialChainTemplate(TemplateBase):
    """顺序链模板 - 多个步骤依次执行"""
    
    def __init__(self, config_path: Optional[str] = None):
        super().__init__(config_path)
        self.chain = None
        
    def setup(self, **parameters) -> None:
        """设置顺序链"""
        if not self.validate_parameters(parameters):
            raise ValueError("参数验证失败")
        
        llm = parameters.get('llm')
        if not llm:
            raise ValueError("必须提供LLM实例")
        
        steps = parameters.get('steps', [])
        if not steps:
            raise ValueError("必须提供链步骤配置")
        
        # 创建各个步骤的链
        chains = []
        for i, step in enumerate(steps):
            prompt = PromptTemplate(
                input_variables=step['input_variables'],
                template=step['template']
            )
            
            chain = LLMChain(
                llm=llm,
                prompt=prompt,
                output_key=step['output_key']
            )
            chains.append(chain)
        
        # 构建顺序链
        input_variables = steps[0]['input_variables']
        output_variables = [step['output_key'] for step in steps]
        
        self.chain = SequentialChain(
            chains=chains,
            input_variables=input_variables,
            output_variables=output_variables,
            verbose=parameters.get('verbose', False)
        )
    
    def execute(self, **kwargs) -> Any:
        """执行顺序链"""
        if not self.chain:
            raise RuntimeError("请先调用setup()方法初始化链")
        
        return self.chain.invoke(kwargs)
    
    def get_example(self) -> Dict[str, Any]:
        """获取使用示例"""
        return {
            "setup_parameters": {
                "steps": [
                    {
                        "input_variables": ["topic"],
                        "template": "为主题'{topic}'生成一个详细的大纲",
                        "output_key": "outline"
                    },
                    {
                        "input_variables": ["outline"],
                        "template": "基于以下大纲写一篇文章：
{outline}",
                        "output_key": "article"
                    },
                    {
                        "input_variables": ["article"],
                        "template": "为以下文章写一个摘要：
{article}",
                        "output_key": "summary"
                    }
                ],
                "verbose": True
            },
            "execute_parameters": {
                "topic": "人工智能在教育中的应用"
            },
            "usage_code": """
# 使用示例
from templates.chains.sequential_chain import SequentialChainTemplate
from langchain_openai import ChatOpenAI

# 初始化LLM
llm = ChatOpenAI(model="gpt-3.5-turbo")

# 初始化模板
template = SequentialChainTemplate()

# 设置链步骤
steps = [
    {
        "input_variables": ["topic"],
        "template": "为主题'{topic}'生成一个详细的大纲",
        "output_key": "outline"
    },
    {
        "input_variables": ["outline"],
        "template": "基于以下大纲写一篇文章：
{outline}",
        "output_key": "article"
    }
]

template.setup(llm=llm, steps=steps)

# 执行链
result = template.execute(topic="人工智能在教育中的应用")
print(result["article"])
"""
        }
```

### 配置系统

#### 配置加载器
```python
# templates/base/config_loader.py
import yaml
import os
from typing import Dict, Any, Optional
from .template_base import TemplateConfig

class ConfigLoader:
    """配置文件加载器"""
    
    def __init__(self, config_dir: str = "templates/configs"):
        self.config_dir = config_dir
        
    def load_from_file(self, config_path: str) -> TemplateConfig:
        """从文件加载配置"""
        with open(config_path, 'r', encoding='utf-8') as f:
            config_data = yaml.safe_load(f)
        
        return TemplateConfig(**config_data)
    
    def load_default(self, template_name: str) -> TemplateConfig:
        """加载默认配置"""
        config_file = os.path.join(
            self.config_dir, 
            "template_configs", 
            f"{template_name.lower()}.yaml"
        )
        
        if os.path.exists(config_file):
            return self.load_from_file(config_file)
        
        # 返回默认配置
        return TemplateConfig(
            name=template_name,
            description=f"{template_name}模板",
            parameters={},
            dependencies=[],
            examples=[]
        )
```

## 实现步骤

1. **建立模板框架**
   - 创建基础目录结构
   - 实现模板基类和配置系统
   - 创建参数验证器

2. **LLM模板开发**
   - OpenAI、Anthropic、本地模型模板
   - 多模型对比和切换模板

3. **Prompt模板开发**
   - 各种场景的提示词模板
   - 动态参数替换系统

4. **Chain模板开发**
   - 顺序、并行、条件链模板
   - 复杂工作流组合模板

5. **Agent模板开发**
   - 不同类型的代理模板
   - 工具集成和多代理协作

6. **数据处理模板**
   - 文档处理和向量化模板
   - 检索和知识库构建模板

7. **记忆和评估模板**
   - 各种记忆机制模板
   - 评估和测试框架模板

8. **文档和示例**
   - 每个模板的详细使用文档
   - 实际应用场景示例

## 成功指标

- 模板系统覆盖所有主要LangChain功能
- 参数化配置灵活且易用
- 代码复用性高，扩展性强
- 文档完善，示例丰富
- 学习者可快速上手并应用到实际项目

## 依赖项

- 依赖任务002（核心框架）提供的项目结构
- LangChain相关包和依赖
- 配置文件管理系统
- 参数验证框架

## 风险与缓解

**风险**: 模板过于复杂，学习者难以理解
**缓解**: 提供从简单到复杂的渐进式模板，详细注释

**风险**: 配置参数过多，使用困难
**缓解**: 提供合理的默认值和配置向导

**风险**: 模板维护成本高
**缓解**: 建立自动化测试和文档生成系统
